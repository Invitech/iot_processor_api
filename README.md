# Insights Platform Processor API
This repository contains the specification of the Processor API, which can be used to create custom processors for the Insights Platform. By implementing this API, it's possible to create new data processors for the Insights Platform that can define how to handle adding/removing custom types of resources and sending/receiving data to/from those resources.

## Features
- Secure two-way communication interface between the processors and the platform
- Extending the platform with new resource types
  - Required or optional parameters which can be asked for when adding a new resource of this type to the platform
  - Deeply defined incoming data types which can be processed and validated like any other data on the platform
  - Functions that can be called on a resource of this type
    - Required or optional parameters which can be entered when a user wants to call that function, or can be used in alerts.
    - Return values which can later be used to handle response status
- Versioning and syncing capabilities for handling updates

## Security
The API uses JWT bearer authentication in both directions.  
The token is generated by the platform and signed with RS256, the public key can be found [here](JWT.pub).  
See [Security](https://github.com/Invitech/iot_processor_api/wiki/Security) for more information.

## Components
1. The interfaces a processor needs to implement
   - [Version interface](https://github.com/Invitech/iot_processor_api/wiki/Version-interface) (fixed)
     - Provides a service for retrieving the latest supported protocol version of the processor.
   - [Resource interface](https://github.com/Invitech/iot_processor_api/wiki/Resource-interface) (versioned)
     - Provides a service for getting information about available resource types, and adding/removing managed resources.
   - [Function interface](https://github.com/Invitech/iot_processor_api/wiki/Function-interface) (versioned)
     - Provides a service for getting information about available resource functions, and calling functions on managed resources.
   - [Server interface](https://github.com/Invitech/iot_processor_api/wiki/Server-interface) (versioned)
     - Provides a service for assigning/unassigning servers, and changing tokens of assigned servers.
2. The interface provided by the [Insights Platform](https://github.com/Invitech/iot_processor_api/wiki/Platform-interface):
   - Provides a service for handling processor lifecycle and receiving data from resources.

## Getting Started
Read our [Wiki](https://github.com/Invitech/iot_processor_api/wiki) to get the details about the interfaces, or take a look at our SDK in one of the following languages:

* [Java](https://github.com/Invitech/iot_processor_sdk_java)
* More to come, stay tuned.

You can also check use Swagger files for the API [here](swagger)

## MQTT Support
The Insights Platform also has support for connecting resources over the MQTT protocol.  
If your resource sends JSON data, and you don't have any special needs, you can directly connect to our server and you don't need to implement a custom processor.

The connection info is provided by the platform when you add a new MQTT resource, but generally it looks like this:
- Server address and port: TBD
- User: application.{applicationId}
  - Example: application.5
- Password: generated by the platform
- Topic: application.{applicationId}.resource.{resourceId}
  - Example: application.5.resource.3
- Data: Anything in JSON format in any depth.

The key of the data will be used to identify the sensor type, if it's one of the predefined types (temperature, humidity, pressure, charge, rssi) the system will use it as such, otherwise it will be handled as custom data according to it's type.  
The keys will be flattened and only primitive values will be used.

Example:
  
Incoming data:
```JSON
{
  "my_sensor": {
    "temperature": 24
  },
  "other_data": {
    "values": {
      "humidity": 67.2
    },
    "text": "test message"
  }
}
```
Parsed data:
```JSON
{
  "temperature": 24,
  "humidity": 67.2,
  "text": "test message"
}
```
